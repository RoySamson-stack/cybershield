# Generated by Django 4.2.26 on 2025-12-06 18:01

import django.core.validators
from django.db import migrations, models
import django.db.models.deletion
import uuid


class Migration(migrations.Migration):
    initial = True

    dependencies = [
        ("core", "0002_subscription_has_malware_analysis_and_more"),
    ]

    operations = [
        migrations.CreateModel(
            name="MalwareSample",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("file_name", models.CharField(max_length=500)),
                ("file_size", models.BigIntegerField()),
                ("file_type", models.CharField(max_length=100)),
                (
                    "md5_hash",
                    models.CharField(db_index=True, max_length=32, unique=True),
                ),
                ("sha1_hash", models.CharField(db_index=True, max_length=40)),
                (
                    "sha256_hash",
                    models.CharField(db_index=True, max_length=64, unique=True),
                ),
                ("file_path", models.CharField(blank=True, max_length=1000, null=True)),
                ("is_stored", models.BooleanField(default=False)),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("pending", "Pending Analysis"),
                            ("analyzing", "Analyzing"),
                            ("completed", "Analysis Complete"),
                            ("failed", "Analysis Failed"),
                        ],
                        default="pending",
                        max_length=20,
                    ),
                ),
                ("submitted_at", models.DateTimeField(auto_now_add=True)),
                ("analyzed_at", models.DateTimeField(blank=True, null=True)),
                ("is_malicious", models.BooleanField(default=False)),
                (
                    "threat_score",
                    models.IntegerField(
                        default=0,
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(100),
                        ],
                    ),
                ),
                (
                    "threat_family",
                    models.CharField(blank=True, max_length=255, null=True),
                ),
                (
                    "threat_type",
                    models.CharField(blank=True, max_length=255, null=True),
                ),
                ("metadata", models.JSONField(default=dict)),
                ("tags", models.JSONField(default=list)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "organization",
                    models.ForeignKey(
                        blank=True,
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="malware_samples",
                        to="core.organization",
                    ),
                ),
            ],
            options={
                "db_table": "malware_samples",
                "ordering": ["-submitted_at"],
            },
        ),
        migrations.CreateModel(
            name="VirusTotalAnalysis",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("scan_id", models.CharField(blank=True, max_length=255, null=True)),
                ("permalink", models.URLField(blank=True, null=True)),
                ("positives", models.IntegerField(default=0)),
                ("total_engines", models.IntegerField(default=0)),
                (
                    "detection_ratio",
                    models.DecimalField(
                        blank=True, decimal_places=2, max_digits=5, null=True
                    ),
                ),
                ("engine_results", models.JSONField(default=dict)),
                ("scan_date", models.DateTimeField(blank=True, null=True)),
                ("first_seen", models.DateTimeField(blank=True, null=True)),
                ("last_seen", models.DateTimeField(blank=True, null=True)),
                ("additional_info", models.JSONField(default=dict)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "sample",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="virustotal_analysis",
                        to="malware.malwaresample",
                    ),
                ),
            ],
            options={
                "db_table": "virustotal_analyses",
                "ordering": ["-scan_date"],
            },
        ),
        migrations.CreateModel(
            name="ThreatPattern",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("pattern_name", models.CharField(max_length=255)),
                (
                    "pattern_type",
                    models.CharField(
                        choices=[
                            ("technique", "Attack Technique"),
                            ("behavior", "Behavioral Pattern"),
                            ("signature", "Signature Pattern"),
                            ("ioc", "Indicator Pattern"),
                            ("family", "Malware Family Pattern"),
                        ],
                        max_length=50,
                    ),
                ),
                ("description", models.TextField()),
                ("indicators", models.JSONField(default=dict)),
                ("techniques", models.JSONField(default=list)),
                (
                    "confidence_score",
                    models.DecimalField(
                        decimal_places=4,
                        max_digits=5,
                        validators=[
                            django.core.validators.MinValueValidator(0.0),
                            django.core.validators.MaxValueValidator(1.0),
                        ],
                    ),
                ),
                ("sample_count", models.IntegerField(default=0)),
                ("first_detected", models.DateTimeField(auto_now_add=True)),
                ("last_seen", models.DateTimeField(auto_now=True)),
                ("detection_frequency", models.JSONField(default=dict)),
                ("is_trending", models.BooleanField(default=False)),
                (
                    "trend_score",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                ("tags", models.JSONField(default=list)),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("low", "Low"),
                            ("medium", "Medium"),
                            ("high", "High"),
                            ("critical", "Critical"),
                        ],
                        default="medium",
                        max_length=20,
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "db_table": "threat_patterns",
                "ordering": ["-confidence_score", "-last_seen"],
                "indexes": [
                    models.Index(
                        fields=["pattern_type", "is_trending"],
                        name="threat_patt_pattern_711f2e_idx",
                    ),
                    models.Index(
                        fields=["severity", "confidence_score"],
                        name="threat_patt_severit_194056_idx",
                    ),
                    models.Index(
                        fields=["last_seen"], name="threat_patt_last_se_9dad45_idx"
                    ),
                ],
            },
        ),
        migrations.CreateModel(
            name="BehavioralAnalysis",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("files_created", models.JSONField(default=list)),
                ("files_modified", models.JSONField(default=list)),
                ("files_deleted", models.JSONField(default=list)),
                ("files_read", models.JSONField(default=list)),
                ("registry_keys_created", models.JSONField(default=list)),
                ("registry_keys_modified", models.JSONField(default=list)),
                ("network_connections", models.JSONField(default=list)),
                ("dns_queries", models.JSONField(default=list)),
                ("http_requests", models.JSONField(default=list)),
                ("domains_contacted", models.JSONField(default=list)),
                ("processes_created", models.JSONField(default=list)),
                ("processes_injected", models.JSONField(default=list)),
                ("services_created", models.JSONField(default=list)),
                ("scheduled_tasks_created", models.JSONField(default=list)),
                ("iocs", models.JSONField(default=dict)),
                ("analysis_duration", models.IntegerField(blank=True, null=True)),
                (
                    "sandbox_environment",
                    models.CharField(blank=True, max_length=255, null=True),
                ),
                (
                    "analysis_tool",
                    models.CharField(blank=True, max_length=255, null=True),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "sample",
                    models.OneToOneField(
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="behavioral_analysis",
                        to="malware.malwaresample",
                    ),
                ),
            ],
            options={
                "db_table": "behavioral_analyses",
                "ordering": ["-created_at"],
            },
        ),
        migrations.CreateModel(
            name="ThreatIntelligence",
            fields=[
                (
                    "id",
                    models.UUIDField(
                        default=uuid.uuid4,
                        editable=False,
                        primary_key=True,
                        serialize=False,
                    ),
                ),
                ("title", models.CharField(max_length=500)),
                ("description", models.TextField()),
                ("summary", models.TextField(blank=True, null=True)),
                ("threat_type", models.CharField(max_length=100)),
                (
                    "threat_family",
                    models.CharField(blank=True, max_length=255, null=True),
                ),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("low", "Low"),
                            ("medium", "Medium"),
                            ("high", "High"),
                            ("critical", "Critical"),
                        ],
                        default="medium",
                        max_length=20,
                    ),
                ),
                ("iocs", models.JSONField(default=dict)),
                ("techniques", models.JSONField(default=list)),
                ("detection_timeline", models.JSONField(default=list)),
                ("affected_regions", models.JSONField(default=list)),
                ("affected_industries", models.JSONField(default=list)),
                ("ml_insights", models.JSONField(default=dict)),
                (
                    "prediction_confidence",
                    models.DecimalField(
                        blank=True, decimal_places=4, max_digits=5, null=True
                    ),
                ),
                ("source", models.CharField(default="cybershield_ml", max_length=255)),
                ("is_verified", models.BooleanField(default=False)),
                ("tags", models.JSONField(default=list)),
                ("requires_pro_tier", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
                (
                    "related_patterns",
                    models.ManyToManyField(blank=True, to="malware.threatpattern"),
                ),
                (
                    "related_samples",
                    models.ManyToManyField(blank=True, to="malware.malwaresample"),
                ),
            ],
            options={
                "db_table": "malware_threat_intelligence",
                "ordering": ["-severity", "-created_at"],
                "indexes": [
                    models.Index(
                        fields=["severity", "created_at"],
                        name="malware_thr_severit_a584b8_idx",
                    ),
                    models.Index(
                        fields=["threat_type", "created_at"],
                        name="malware_thr_threat__517135_idx",
                    ),
                    models.Index(
                        fields=["requires_pro_tier", "created_at"],
                        name="malware_thr_require_a36117_idx",
                    ),
                ],
            },
        ),
        migrations.AddIndex(
            model_name="malwaresample",
            index=models.Index(
                fields=["md5_hash"], name="malware_sam_md5_has_a552f2_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="malwaresample",
            index=models.Index(
                fields=["sha256_hash"], name="malware_sam_sha256__88981e_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="malwaresample",
            index=models.Index(
                fields=["status", "created_at"], name="malware_sam_status_25514a_idx"
            ),
        ),
        migrations.AddIndex(
            model_name="malwaresample",
            index=models.Index(
                fields=["is_malicious", "threat_score"],
                name="malware_sam_is_mali_437f45_idx",
            ),
        ),
        migrations.AddIndex(
            model_name="malwaresample",
            index=models.Index(
                fields=["threat_family", "created_at"],
                name="malware_sam_threat__3279b8_idx",
            ),
        ),
    ]

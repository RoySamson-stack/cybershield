"""Management command to learn threat patterns"""
from django.core.management.base import BaseCommand
from apps.malware.ml_service import ThreatPatternLearningService


class Command(BaseCommand):
    help = 'Learn threat patterns from malware samples'

    def add_arguments(self, parser):
        parser.add_argument(
            '--days',
            type=int,
            default=30,
            help='Number of days to look back (default: 30)',
        )

    def handle(self, *args, **options):
        days = options['days']
        
        self.stdout.write(f'Learning threat patterns from last {days} days...')
        
        service = ThreatPatternLearningService()
        patterns = service.learn_patterns(days=days)
        
        # Update trends
        service.update_trends()
        
        self.stdout.write(
            self.style.SUCCESS(
                f'\nLearned {len(patterns)} threat patterns:\n'
            )
        )
        
        for pattern in patterns[:10]:  # Show first 10
            self.stdout.write(f'  - {pattern.pattern_name} ({pattern.pattern_type}, confidence: {pattern.confidence_score:.2f})')








